<main class="section">
    <div class="row">
        <div class="col s1"></div> <!-- TODO borrar esto y reparar offset -->
        <div class="col s2">
            <form name="shelfForm" class="css-form"  ng-submit="submitSearch()" novalidate>
                <h5>Filter by Status</h5>
                <p ng-repeat="playStatus in playStatuses" class="checkbox-list">
                    <input type="checkbox" name="playStatusesCheckbox" id="{{playStatus}}" value="{{playStatus}}"/>
                    <!--{{((containsPlayStatusesFilter(playStatus))? 'checked' : '')}} TODO droche-->
                    <label class="wrap-text" for="{{playStatus}}">{{playStatus}}</label>
                </p>
                <h5>Filter by Shelf</h5>
                <p ng-repeat="shelf in shelves" class="checkbox-list">
                    <input type="checkbox" name="shelvesCheckbox" id="{{shelf.id}}" value="{{shelf.name}}"/>
                    <!--<c:if test="${shelvesFilter.contains(shelf.name)}">checked</c:if>-->
                    <label class="wrap-text" for="{{shelf.id}}">
                        {{shelf.name}}
                        <a ng-if="isUserLoggedOwner" ng-click="editShelf(shelf)"
                           class="rename material-icons black-text" style="vertical-align: middle;">mode_edit</a>
                        <a ng-if="isUserLoggedOwner" ng-click="deleteShelf(shelf)"
                           class="delete-shelf material-icons red-text text-lighten-1" style="vertical-align: middle;">delete</a>
                    </label>
                </p>
                <button type='submit' class='btn waves-effect'>Filter <i class="material-icons right">filter_list</i></button>
            </form>
            <br/>
            <!--<%&#45;&#45;<c:if test="${fn:length(shelves) == 0}">&#45;&#45;%>-->
            <!--<%&#45;&#45;<h4 class="center">No shelves. <c:if test="${user.username == currentUsername}">Why not create one?</c:if></h4>&#45;&#45;%>-->
            <!--<%&#45;&#45;</c:if>&#45;&#45;%>-->
            <div ng-if="isCurrentUserLogged()">
                <div class="col s12 divider"></div>
                <h5 style="margin-bottom:0;">Create a Shelf</h5>
                <form ng-submit="createShelf()">
                <!--<form class="css-form" novalidate id="new-shelf-form">-->
                    <div class="input-field col s12" style="margin-top: 0; padding:0;">
                        <input type="text" name="name" ng-model="newShelfName"/>
                        <!--length="25" required-->
                    </div>
                    <button type='submit' class='btn waves-effect light-blue'>Create <i class="material-icons right">playlist_add</i>
                    </button>
                </form>
            </div>
            <!--<div ng-hide = "!isUserLoggedOwner">-->
                <!--<div class="col s12 divider"></div>-->
                <!--<h5 style="margin-bottom:0;">Create a Shelf</h5>-->
                <!--<form ng-submit="createShelf()">-->
                    <!--&lt;!&ndash;<form class="css-form" novalidate id="new-shelf-form">&ndash;&gt;-->
                    <!--<div class="input-field col s12" style="margin-top: 0; padding:0;">-->
                        <!--<input type="text" name="name" ng-model="newShelfName"/>-->
                        <!--&lt;!&ndash;length="25" required&ndash;&gt;-->
                        <!--<button type='submit' class='btn waves-effect light-blue'>Create <i class="material-icons right">playlist_add</i>-->
                        <!--</button>-->
                    <!--</div>-->
                <!--</form>-->
            <!--</div>-->
            <!--TODO delete if ng-hide was old-->

        </div>
        <div class="col s9">

            <div class="row">
                <h1 class="center">{{user.userName}}'s Game List</h1>
                <h5 ng-if="isUserLoggedOwner" class="center"><a ng-href="#search">Search games</a> to add them to
                    your list!</h5>
                <div class="col s12 divider"></div>
                <br/>
                <h5 ng-if="games.length == 0" class="center">No results</h5>
                <!--Games list header-->
                <div ng-if="games.length != 0" class="col s12 center" id="games-list-header">
                    <p class="col s2">Cover Picture</p>
                    <p class="col s3 ">Title</p>
                    <p class="col s1 ">Play Status</p>
                    <p class="col s2 ">Shelves</p>
                    <p class="col s1 ">Avg. Rating</p>
                    <p class="col s2 ">Own score</p>
                    <p class="col s1"></p>
                </div>
                <ul ng-if="games.length != 0" class="collection games-list">
                    <!--TODO limit number of shown games, create link to show more-->
                    <li ng-repeat="game in games" class="collection-item avatar col s12">
                        <div class="col s2 cover-pic-container valign-wrapper">
                            <img class="cover-picture valign" ng-src="{{game.coverPictureUrl}}" alt="{{game.name}}">
                        </div>
                        <div class="col primary-content s3">
                            <p class="title wrap-text"><a ng-href="#game?id={{game.id}}">{{game.name}}</a></p>
                        </div>
                        <div class="col s1 center">
                            <p style="margin-top: 33px;"><b>
                                <!-- TODO {{empty playStatuses.get(game) ? "No status" : playStatuses.get(game).pretty}-->
                                TODO STATUS
                            </b></p>
                        </div>
                        <div class="col s2 center" ng-init="gameShelves = getGameShelves(game)">

                            <!--<p style="margin-top: 33px;"><b>-->

                                <!--TODO SHELVES-->
                                <span ng-if="gameShelves.length == 0">L: {{gameShelves.length}} HOLA  No shelves</span>
                                <span ng-if="gameShelves.length != 0" ng-repeat="shelf in gameShelves">L: {{gameShelves.length}} HOLA {{shelf.name}} </span>

                                <!--<c:choose>-->
                                <!--<c:when test="${ empty shelvesForGamesMap.get(game)}">No shelves</c:when>-->
                                <!--<c:otherwise>-->
                                <!--<c:forEach items="${shelvesForGamesMap.get(game)}" var="shelf">-->
                                <!--<c:out value="${shelf.name}"/>-->
                                <!--</c:forEach>-->
                                <!--</c:otherwise>-->
                                <!--</c:choose>-->
                            <!--</b></p>-->
                        </div>
                        <div class="col s1 center">
                            <p style="margin-top: 33px;"><b>
                                {{(game.avgScore === null || game.avgScore == 0)?'No avg rating':(game.avgScore |
                                number:2)}}
                            </b>
                            </p>
                        </div>
                        <div class="col s2 center">
                            <!--
                            <div class="secondary-content">-->
                                <!--<c:set var="score" value="${scores.get(game)}"/> TODO game.userScore-->
                                <p ng-if="game.userScore <= 10 && game.userScore>=0" style="margin-top: 27px;"
                                   class="rating-number center"><b>{{game.userScore}}</b></p>
                                <p ng-if="game.userScore <= 10 && game.userScore>=0"
                                   class="rating-stars hide-on-small-and-down">
                                <div ng-repeat="i in [0,1,2,3,4]">
                                    <div ng-if="(game.userScore - (i * 2) - 1 ) < 0">
                                        <i class="material-icons">star_border</i>
                                    </div>
                                    <div ng-if="(game.userScore - (i * 2) - 1 ) == 0">
                                        <i class="material-icons">star_half</i>
                                    </div>
                                    <div ng-if="(game.userScore - (i * 2) - 1) > 0">
                                        <i class="material-icons">star</i>
                                    </div>
                                </div>
                                </p>
                                <p ng-if="game.userScore > 10 || game.userScore<0" style="margin-top: 33px;"
                                   class="rating-number center"><b>Unrated</b></p>
                                <!--
                            </div>
                            -->
                        </div>
                        <div class="col s1">
                            <div class="secondary-content">
                                <a ng-click="deleteGame(game)"
                                   class=" delete-game material-icons red-text text-lighten-1" style="vertical-align: middle;">delete</a>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="row col s12 divider"></div>

            <div class="container">
                <div class="section">
                        <div ng-if="recommendedGames.length > 0" class="row">
                            <h5 class="center">Recommended Games for
                                    <!--<c:if test="${! empty shelvesFilter}">for this shelves</c:if>!-->
                                <span ng-if="isUserLoggedOwner">you</span>
                                <span ng-if="!isUserLoggedOwner">{{user.userName}}</span>
                            !</h5>
                            <div class="slick-carousel center" id="recommended-carousel" data-slick='{"slidesToShow": {{recommendedMin}}, "slidesToScroll": {{recommendedMin}}}'>
                                <div class="slide-container" ng-repeat="game in recommendedGames" on-complete="recommendedRendered">
                                    <a ng-href="#game?id={{game.id}}">
                                        <img ng-src="{{game.coverPictureUrl}}" class="valign"/>
                                        <!--data-lazy-->
                                    </a>
                                    <h5 class="center slide-text">
                                        <a ng-href="#game?id={{game.id}}">{{game.name}}</a>
                                    </h5>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="col s1">

        </div>
    </div>
</main>

<script type="text/javascript">
    require(['slick-carousel'], function() {
        //TODO consider only doing this if there are picture or videos
        $(function() {
            $('.slick-carousel').slick({
                infinite: false,
                slidesToShow: 4,
                slidesToScroll: 4,
                arrows: true,
                lazyload: 'ondemand'
            });
        });

        //TODO initialize Slick for related games
    });
</script>
