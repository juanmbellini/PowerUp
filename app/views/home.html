<main>
    <!--Updates!-->
    <div class="container">
        <div class="section no-pad-top">
            <ul class="collection reviews-list">
                <li ng-repeat="feedElement in feed" class="collection-item avatar">
                    <div ng-if="feedElement.type === 'review' ">
                        <div  class="row" style="margin-bottom: 0">
                            <div class="col s10">
                                <img ng-src="{{apiLocation}}/users/{{feedElement.data.userId}}/picture"
                                     alt="{{feedElement.data.username}}" class="circle">
                                <span class="title wrap-text">
                                    <a ng-href="#profile?username={{feedElement.data.username}}">{{feedElement.data.username}}</a> |
                                    <a ng-href="#game?id={{feedElement.data.gameId}}">{{feedElement.data.gameName}}</a>
                                </span>
                                <p class="wrap-text smallText">
                                    <span>
                                        <a ng-href="#reviews?userId={{feedElement.data.userId}}">Other
                                        reviews by {{feedElement.data.username}}</a> | <a ng-href="#reviews?gameId={{feedElement.data.gameId}}">Other
                                        {{feedElement.data.gameName}} reviews</a>
                                    </span>
                                </p>
                                <p ng-show="feedElement.data.shelves.length > 0" class="wrap-text smallText"> Shelves:
                                    <span ng-repeat="shelf in feedElement.data.shelves"><a ng-href="#list?id={{feedElement.data.userId}}&shelf={{shelf.name}}">{{shelf.name}}</a>{{!$last ? ', ' : ''}}</span>
                                </p>
                            </div>
                            <div class="col s2">
                                <p class="right-align" style="color: black;">{{feedElement.data.date | date: 'mediumDate'}}</p>
                                <p class="right-align">
                                    <a ng-if="canDeleteReview(feedElement.data)" ng-href="#write-review?id={{gameId}}" class="material-icons blue-text text-lighten-1 "><i class="material-icons right">mode_edit</i></a>
                                    <a ng-if="canDeleteReview(feedElement.data)" ng-click="deleteReview(feedElement.data)" href=""
                                       class="material-icons red-text text-lighten-1 delete-button ">
                                        <i class="material-icons right">delete</i>
                                    </a>
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s10">
                                <p class="wrap-text preserve-newlines">{{feedElement.data.body}}</p>
                            </div>
                            <div class="col s2">
                                <div ng-switch="(feedElement.data.overallScore<=10 && feedElement.data.overallScore>0)">
                                    <div ng-switch-when="true">
                                        <p class="rating-number"><b>Overall: <span class="right">{{feedElement.data.overallScore}}</span></b></p>
                                    </div>
                                    <div ng-switch-default>
                                        <p class="rating-number center"><b>Unrated</b></p>
                                    </div>
                                </div>
                                <p style="color: #26a69a;">
                                    Story: <span class="right">{{feedElement.data.storyScore}}</span>
                                    <br/>
                                    Graphics: <span class="right">{{feedElement.data.graphicsScore}}</span>
                                    <br/>
                                    Audio: <span class="right">{{feedElement.data.audioScore}}</span>
                                    <br/>
                                    Controls: <span class="right">{{feedElement.data.controlsScore}}</span>
                                    <br/>
                                    Fun: <span class="right">{{feedElement.data.funScore}}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div ng-if="feedElement.type === 'thread'">
                        <img ng-src="{{feedElement.data.creator.profilePictureUrl}}" alt="{{feedElement.data.creator.username}}" class="circle">
                        <a class="title truncate" ng-href="#thread/{{feedElement.data.id}}">{{feedElement.data.title}}</a>

                        <p>Submitted {{feedElement.data.createdAt | date: 'medium'}} by <a ng-href="#profile?username={{feedElement.data.creator.username}}">{{feedElement.data.creator.username}}</a></p>
                        <br>
                        <p class="truncate">{{feedElement.data.body}}</p>

                        <!--Un/like section-->
                        <span class="secondary-content">
                                <b style="vertical-align: text-bottom">{{feedElement.data.likeCount}}</b>
                            <!--Not logged in - black actionless thumbs up-->
                                <i ng-if="!isLoggedIn" class="material-icons black-text">thumb_up</i>
                            <!--Logged in and liked - green thumbs up with action to unlike-->
                                <a ng-if="isLoggedIn && isLikedByCurrentUser(feedElement.data)" ng-click="unlikeThread(feedElement.data)" ng-class="{disabled: feedElement.data.likesDisabled}" href="">
                                    <i class="material-icons green-text">thumb_up</i>
                                </a>
                            <!--Logged in and not liked - black thumbs up with action to like-->
                                <a ng-if="isLoggedIn && !isLikedByCurrentUser(feedElement.data)" ng-click="likeThread(feedElement.data)" ng-class="{disabled: feedElement.data.likesDisabled}" href="">
                                    <i class="material-icons black-text">thumb_up</i>
                                </a>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="section no-pad-bot" id="index-banner">
        <div class="container">
            <br><br>
            <h1 class="header center orange-text">PowerUp</h1>
            <div class="row center">
                <h5 class="header col s12 light">Your videogame database and discovery platform</h5>
            </div>
            <div class="row">
                <div class="col s12 m8 offset-m2 l6 offset-l3">
                    <form ng-submit="submitSearch()" id="search-form">
                        <div class="input-field">
                            <input type="search" ng-model="gameTitle" name="name" id="indexSearchBar"/>
                            <i class="material-icons" ng-click="submitSearch()" style="color:black;" id="search-icon">search</i>
                        </div>
                    </form>
                </div>
            </div>
            <br />
            <br />
        </div>
    </div>
    <!--TODO show loading?-->
    <!-- Recommended games -->
    <div class="container">
        <div class="section">
            <div ng-if="recommendedGames && recommendedGames.length > 0" class="row">
                <h5 class="center">Recommended Games for you!</h5>
                <div class="slick-carousel center" id="recommended-carousel" data-slick='{"slidesToShow": {{recommendedMin}}, "slidesToScroll": {{recommendedMin}}}'>
                    <div class="slide-container" ng-repeat="game in recommendedGames" on-complete="recommendedRendered">
                        <a ng-href="#game?id={{game.id}}">
                            <img ng-src="{{game.coverPictureUrl}}" class="valign"/>
                            <!--data-lazy-->
                        </a>
                        <h5 class="center slide-text">
                            <a ng-href="#game?id={{game.id}}">{{game.name}}</a>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <!--   Icon Section   -->
            <div class="row">
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center light-blue-text"><i class="material-icons">search</i></h2>
                        <h5 class="center">Search</h5>
                        <p class="light">
                            Our extensive game database, powered by <a href="http://www.igdb.com" target="_blank">IGDB.com</a>, contains games
                            from every year, every console, every publisher, every genre, every developer that you could think of. Dive into
                            the little details of every game that you played in your childhood or plan to play in the future.
                        </p>
                    </div>
                </div>
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center light-blue-text"><i class="material-icons">visibility</i></h2>
                        <h5 class="center">Discover</h5>
                        <p class="light">
                            Discover new games based on your searches and game history. With our game suggestion engine
                            you will find so many cool games that you will wonder why you didn't come across them earlier.
                        </p>
                    </div>
                </div>
                <div class="col s12 m4">
                    <div class="icon-block">
                        <h2 class="center light-blue-text"><i class="material-icons">group</i></h2>
                        <h5 class="center">Compare (coming soon)</h5>
                        <p class="light">
                            Join the PowerUp community and compare game collections and interests. Maybe you'll find
                            someone who has played through every single released Mario game in history? How will your
                            collection compare to others'?
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>


<script type="text/javascript">
    require(['slick-carousel'], function() {
        //TODO consider only doing this if there are recommendedGames
        $(function() {
            $('.slick-carousel').slick({
                infinite: false,
                slidesToShow: 4,
                slidesToScroll: 4,
                arrows: true,
                lazyload: 'ondemand'
            });
        });
    });
</script>