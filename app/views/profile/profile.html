<main class="section container">
    <div ng-if="requestedUser === null" class="center">
        <h5>Fetching profile...</h5>
        <loading-circle></loading-circle>
    </div>
    <div ng-if="requestedUser !== null">
        <h1 class="center orange-text">{{username}}'s Profile</h1>
        <div class="row">
            <div class="col s4">
                <img ng-if="requestedUser" ng-src="{{profile.picture.temp || profile.picture.data || profile.picture.url}}" style="max-width: 100%; height:auto;" ng-style="{opacity: pictureSubmitDisabled ? 1 : 0.5}"/>
                <div ng-if="canChangePicture()">
                    <form id="pictureForm">
                        <div class="row">
                            <div class="file-field input-field">
                                <div class="btn waves-effect waves-light">
                                    <span>Upload picture</span>
                                    <input type="file" accept=".jpeg, .jpg, .png, .gif" ngf-select="parseProfilePicture($file)" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <button class="btn waves-effect waves-light" type="submit" name="action" ng-disabled="pictureSubmitDisabled" ng-click="uploadProfilePicture()">
                                {{uploadingPicture ? 'Uploading...' : 'Submit'}}
                                <i class="material-icons right">send</i>
                            </button>
                            <div ng-show="uploadingPicture" id="profile-picture-loading-circle">
                                <loading-circle-small></loading-circle-small>
                            </div>
                            <span ng-if="profile.picture.canDelete">
                                or <a href="" class="red-text" ng-click="confirmDeleteProfilePicture()">delete profile picture</a>
                            </span>
                        </div>
                    </form>
                </div>
                <br />
                <button ng-if="isCurrentUser(requestedUser)" class="btn waves-effect waves-light" ng-click="changePassword()">Change Password</button>
                <button ng-if="canFollow()" class="btn waves-effect waves-light" ng-disabled="followDisabled" ng-click="updateFollow()">{{requestedUser.social.followedByCurrentUser ? "Unfollow" : "Follow"}}<i class="material-icons right">add person</i></button>
            <br />
                <h5>Profile Stats</h5>
                <p>Followers: <b>{{requestedUser.social.followersCount}}</b></p>
                <p>Following: <b>{{requestedUser.social.followingCount}}</b></p>
                <p><b>{{profile.gamesAmount}}</b> <ng-pluralize count="profile.gamesAmount" when="{'one': 'game', 'other': 'games'}"></ng-pluralize> in <a ng-href="#list?id={{requestedUser.id}}">game list</a></p>
            </div>
            <div class="col s8">
                <h4 class="center" ng-if="profile.top10.length > 0">Top 10 games</h4>
                <p class="center" ng-if="profile.top10.length === 0">
                    No scored games. <span ng-if="isCurrentUser(requestedUser)">Why don't you <a href="#search">search</a> and score some?</span>
                </p>
                <ul class="collection games-list" ng-if="profile.top10.length > 0">
                    <!--<c_forEach var="entry" items="${topGames}">-->
                        <!--<c_set var="game" value="${entry.key}" />-->
                        <!--<c_set var="score" value="${entry.value}" />-->
                    <!--</c_forEach>-->

                    <li class="collection-item avatar col s12" ng-repeat="entry in profile.top10">
                        <!--TODO make this into a directive-->
                        <div class="col s2 cover-pic-container valign-wrapper">
                            <a ng-href="#game?id={{entry.gameId}}" class="cover-pic valign"><img ng-src="{{entry.gameCoverPictureUrl}}" alt="{{item.gameName}}"></a>
                        </div>
                        <div class="col primary-content s7">
                            <p class="title">
                                <a ng-href="#game?id={{entry.gameId}}">{{entry.entryName}}</a>
                            </p>
                            <p class="summary" style="display: -webkit-box">{{entry.gameSummary || "No summary"}}</p>
                        </div>
                        <div class="col s1 center">
                            <p style="margin-top: 33px;">{{entry.gameReleaseDate != null ? (game.releaseDate | date : 'yyyy') : "Unknown" }}</p>
                        </div>
                        <div class="col s2">
                            <div class="secondary-content">
                                <div ng-switch="(entry.score <= 10 && entry.score > 0)">
                                    <div ng-switch-when="true">
                                        <!--TODO get score by user, not general score-->
                                        <p class="rating-number center"><b><span>{{entry.score | limitTo:4}}</span></b></p>
                                        <rating-stars rating="entry.score" class="rating-stars hide-on-small-and-down center"></rating-stars>
                                    </div>
                                    <div ng-switch-default>
                                        <p class="rating-number center"><b>Unrated</b></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</main>
