<div class="container"  ng-show="loadingProduct">
  <div class="row">
    <div class="col-md-12">
      <div style="min-height: 70vh; display: flex; align-items: center">
        <img src="/images/loading.gif" class="img-responsive center-block"/>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid" ng-show="!loadingProduct && prod===undefined">

    <div class="row top-pad">
      <div class="col-lg-2 hidden-md hidden-sm hidden-xs">
        <img src="/images/Column-left.png" class="img-responsive">

      </div>
      <div class="col-md-12 col-lg-8" style="text-align: center; padding-bottom: 20px">
        <h3 style="text-align: center">{{'prodpage_notfound' | translate}}</h3>
        <img src="/images/product-not-found.jpg" class="img-responsive center-block" style="max-height: 700px"/>
      </div>
      <div class="col-lg-2 hidden-md hidden-sm hidden-xs">
        <img src="/images/Column-right.png" class="img-responsive">
      </div>

    </div>



</div>

<div class="container" ng-show="!loadingProduct && prod!==undefined">
  <div class="row" style="padding-top: 20px">

  </div>
  <br/>
  <div class="row">
    <div class="col-sm-9 col-md-9 col-xs-9">

        <div ng-if="loggedId != null">
          <div class="row">
            <div class="col-sm-1 col-md-1 col-xs-1">
                <br/>
                <div ng-if="alreadyInterested">
                  <span class="fa fa-star"
                  aria-hidden="true"
                  style="font-size: 50px; color: #ff9900; cursor: pointer;"
                  onmouseout="this.style.cssText='color: #ff9900; font-size: 50px; cursor: pointer;'"
                  onmouseover="this.style.cssText='color: #ffcc80; font-size: 50px; cursor: pointer;'"
                  ng-click="uninterest()"></span>
                </div>

                <div ng-if="!alreadyInterested">
                  <span class="fa fa-star-o"
                  aria-hidden="true"
                  style="font-size: 50px; color: black; cursor: pointer;"
                  onmouseout="this.style.cssText='color: black; font-size: 50px; cursor: pointer;'"
                  onmouseover="this.style.cssText='color: #ffcc80; font-size: 50px; cursor: pointer;'"
                  ng-click="interest()"></span>
                </div>
            </div>
            <div class="col-sm-11 col-md-11 col-xs-11">
              <h1><strong>{{prod.name}} ({{prod.platform.name}})</strong></h1>
            </div>
        </div>

      </div>
      <div ng-if="loggedId == null">
        <h1><strong>{{prod.name}} ({{prod.platform.name}})</strong></h1>
      </div>

      <h3 class="offerAttributes"><strong>{{'prodpage_genre' | translate}}</strong> {{'genres_' + prod.genre |
        translate}}</h3>
      <h3 class="offerAttributes"><strong>{{'prodpage_esrb' | translate}}</strong> {{'esrb_' + prod.esrb | translate}}
      </h3>
      <h3 class="offerAttributes"><strong>{{'prodpage_spmp' | translate}}</strong> {{'mpsp_' + prod.mpsp | translate}}
      </h3>

      <div class="rating-block">
        <h2 class="bold padding-bottom-7">
          <div ng-if="prod.nrRevs == 0">
            <small>{{'prodpage_avgrating' | translate}}</small>
            <small>- / 5</small>
          </div>
          <div ng-if="prod.nrRevs != 0">
            <div ng-if="prod.avgRating <= 2.5">
              <small>{{'prodpage_avgrating' | translate}}</small>
              <small style="color: red">{{prod.avgRating | number:2}}</small>
              <small> / 5</small>
            </div>
            <div ng-if="prod.avgRating <= 3.5 && prod.avgRating > 2.5">
              <small>{{'prodpage_avgrating' | translate}}</small>
              <small style="color: #FF8C00">{{prod.avgRating | number:2}}</small>
              <small> / 5</small>
            </div>
            <div ng-if="prod.avgRating > 3.5">
              <small>{{'prodpage_avgrating' | translate}}</small>
              <small style="color: #32CD32">{{prod.avgRating | number:2}}</small>
              <small> / 5</small>
            </div>
          </div>
        </h2>
      </div>

      <!--Upload same product -->
      <div ng-if="loggedId !== null">
          <button  type="button" class="btn btn-success btn-lg" ng-click="offerProduct()"><span class="glyphicon glyphicon-cloud-upload"></span> {{'prodpage_offergame' | translate}}</button>
      </div>

    </div>

    <div class="col-xs-3 col-sm-3 col-md-3">
      <a class="thumbnail"><img ng-src="/api/images/product/{{prod.prodId}}" onerror="this.src='/images/defaultcover.jpg'"/></a>
    </div>

  </div>
  <div class="row">
    <div class="col-sm-12">
      <hr/>
      <div class="review-block">
        <div class="row">
          <h1>{{'prodpage_reviews_title' | translate}}</h1>
        </div>
        <hr/>
        <div ng-if="reviews.length == 0">
          <h3>{{'prodpage_reviews_empty' | translate}}</h3>
        </div>
        <div ng-repeat="review in reviews | limitTo:reviews_size">
          <div class="row">
            <div class="col-sm-2">
              <div class="review-block-writer">
                <div class="row">
                  <a ng-href="/#/user/{{review.writerId}}">
                    <img src="images/icons/icon{{review.iconId}}.jpg" class="img-responsive img-circle center-block clickable" height="50%" width="50%">
                  </a>
                </div>
                <div class="row" style="text-align: center">
                  <a href="/#/user/{{review.writerId}}">
                    <strong style="color: grey;">{{review.username}}</strong>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-sm-2">
              <br/>
              <rating
                      ng-model="rate"
                      max="review.rating"
                      readonly="true"
                      state-off="'glyphicon glyphicon-star'">
              </rating>
              <div class="review-block-date">{{review.date | date}}</div>
            </div>

            <div class="col-sm-8">
              <div class="review-block-title" style="word-wrap:break-word;"><h3><strong>{{review.title}}</strong></h3></div>
              <div class="review-block-review" style="color:grey; word-wrap:break-word;">{{review.review}}</div>
            </div>
          </div>
          <hr/>
        </div>
        <div ng-if="reviews.length > reviews_size">
          <a href="/#/product/{{prod.prodId}}/reviews">{{'prodpage_seeAllReviews' | translate}}</a>
        </div>
      </div>
    </div>
  </div>
  <div ng-show="loggedId != null">
    <span style="color:grey" ng-show="alreadyReviewed"><br/>{{'prodpage_alreadyReviewed' | translate}}</span>

    <div class="row" style="margin-top:40px;" ng-show="!alreadyReviewed">
      <div class="col-md-12" >
        <div class="well well-sm">
          <div class="text-right">
            <button class="btn btn-default" id="open-review-box" ng-click="displayform()">
              {{'prodpage_reviews_new_review' | translate}}
            </button>
          </div>
          <div class="row" id="post-review-box" style="display:none;">
            <div class="col-md-12">
              <form role="form" name="form" ng-submit="newProductReview()">


                <div class="form-group">
                  <p>
                    <input
                            class="form-control"
                            type="textarea"
                            name="formTitle"
                            ng-model="prodReviewForm.title"
                            placeholder="{{'prodpage_title' | translate}}"
                            rows="1"
                            required
                            maxlength="50"/>
                    <span style="color:red" ng-show="form.formTitle.$dirty && form.formTitle.$invalid">
                              <span ng-show="form.formTitle.$error.required">
                                {{'required_field' | translate}}
                              </span>
                            </span>
                  </p>
                </div>
                <div class="form-group">
                  <input
                          class="form-control" type="textarea" id="review" ng-model="prodReviewForm.review"
                          placeholder="{{'prodpage_review' | translate}}"
                          name="review"
                          maxlength="5000"
                          required
                          rows="7"/>
                  <span style="color:red" ng-show="form.review.$dirty && form.review.$invalid">
                              <span ng-show="form.review.$error.required">
                                {{'required_field' | translate}}
                              </span>
                            </span>
                </div>


                <div class="text-right">
                  <div class="row" style="padding-right: 20px; padding-bottom: 15px;">
                    <rating
                            ng-model="prodReviewForm.rating"
                            max="5"
                            readonly="isReadonly"
                            style="font-size: 25px;"
                            required
                    >
                    </rating>
                  </div>

                  <div class="row" style="padding-right: 20px;">
                    <button class="btn btn-danger"
                      id="close-review-box"
                      ng-click="undisplayform()"
                      style="margin-right: 10px">
                      {{'cancel' | translate}}
                    </button>
                    <button class="btn btn-success" type="submit" ng-disabled="form.$invalid">{{'save' | translate}}
                    </button>

                  </div>

                </div>
              </form>

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="review-block">
    <div class="row">
      <h1>{{'prodpage_offers_title' | translate}}</h1>
      <hr/>
    </div>

    <div ng-if=" offers == null || offers.length == 0" style="padding-bottom: 20px">
      <h3>{{'prodpage_offers_empty' | translate}}</h3>
    </div>

    <div ng-repeat="offer in offers | limitTo:offers_size">
      <div class="row">
        <div class="col-md-12">

          <section class="col-xs-12 col-sm-6 col-md-12">

            <article class="search-result row">
              <div class="col-xs-12 col-sm-12 col-md-2">
                <a href="/#/offer/{{offer.offerId}}" class="thumbnail"><img
                        ng-src="/api/images/offer/{{offer.offerId}}" onerror="this.src='/images/defaultcover.jpg'"/></a>
              </div>
              <div class="col-xs-12 col-sm-12 col-md-8">
                <h5>
                  <img src="images/icons/icon{{offer.offererIconId}}.jpg"
                            class="img-responsive img-circle center-block pull-left"
                            height="3%" width="3%">
                  <div style="padding-left:35px; padding-top:5px;">
                    <a class="result" href='/#/user/{{offer.userId}}'>
                        {{offer.username}}
                    </a>
                  </div>
                </h5>
                <div ng-if="offer.nrRevs == 0">
                  <p class="offerAttributes">{{'prodpage_userRating' | translate}} - </p>
                </div>
                <div ng-if="offer.nrRevs != 0">
                  <div ng-if="offer.userRating <= 2.5">
                    <p class="offerAttributes">{{'prodpage_userRating' | translate}}
                      <small style="color: red">{{offer.userRating | number:2}}</small>
                    </p>
                  </div>
                  <div ng-if="offer.userRating <= 3.5 && offer.userRating > 2.5">
                    <p class="offerAttributes">{{'prodpage_userRating' | translate}}
                      <small style="color: #FF8C00">{{offer.userRating | number:2}}</small>
                    </p>
                  </div>
                  <div ng-if="offer.userRating > 3.5">
                    <p class="offerAttributes">{{'prodpage_userRating' | translate}}
                      <small style="color: #32CD32">{{offer.userRating | number:2}}</small>
                    </p>
                  </div>
                </div>
                <p class="offerAttributes"><strong>{{'offerpage_description' | translate}}</strong>
                  {{offer.description}}</p>
              </div>
              <span class="clearfix border"></span>
            </article>

          </section>
        </div>
      </div>
    </div>
    <div ng-if="offers.length > offers_size">
      <a href="/#/product/{{prod.prodId}}/offers?page=1">{{'prodpage_seeAllOffers' | translate}}</a>
      <br/><br/><br/><br/><br/><br/>
    </div>


  </div>
</div>
